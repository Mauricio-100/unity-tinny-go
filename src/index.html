<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GopuOS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
  <div id="root" class="w-full max-w-xl p-6 bg-gray-800 rounded-lg shadow-lg"></div>

  <script type="text/babel">
    const { useState } = React;

    function GopuApp() {
      const [email, setEmail] = useState("");
      const [password, setPassword] = useState("");
      const [token, setToken] = useState("");
      const [otp, setOtp] = useState("");
      const [error, setError] = useState("");
      const [pkg, setPkg] = useState({ name: "", version: "", source: "", metadata: "" });
      const [publishResult, setPublishResult] = useState("");

      async function signup() {
        try {
          const res = await fetch("https://lod-backend.onrender.com/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();
          if (data.ok) {
            setOtp(data.otp);
            setError("");
          } else {
            setError("√âchec d'inscription");
          }
        } catch {
          setError("Erreur serveur");
        }
      }

      async function login() {
        try {
          const res = await fetch("https://lod-backend.onrender.com/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
          });
          const data = await res.json();
          if (data.token) {
            setToken(data.token);
            setError("");
          } else {
            setError("√âchec de connexion");
          }
        } catch {
          setError("Erreur serveur");
        }
      }

      async function publish() {
        try {
          const res = await fetch("https://lod-backend.onrender.com/publish", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${token}`
            },
            body: JSON.stringify({
              name: pkg.name,
              version: pkg.version,
              source: pkg.source,
              metadata: JSON.parse(pkg.metadata || "{}")
            })
          });
          const data = await res.json();
          setPublishResult(JSON.stringify(data));
        } catch {
          setPublishResult("Erreur de publication");
        }
      }

      return (
        <div className="space-y-6">
          <h1 className="text-3xl font-bold text-center">üê® GopuOS Interface</h1>

          <div className="space-y-2">
            <h2 className="text-xl font-semibold">üîê Authentification</h2>
            <input className="w-full p-2 rounded bg-gray-700" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} />
            <input className="w-full p-2 rounded bg-gray-700" type="password" placeholder="Mot de passe" value={password} onChange={e => setPassword(e.target.value)} />
            <div className="flex space-x-2">
              <button className="flex-1 bg-green-600 hover:bg-green-700 p-2 rounded" onClick={signup}>S'inscrire</button>
              <button className="flex-1 bg-blue-600 hover:bg-blue-700 p-2 rounded" onClick={login}>Connexion</button>
            </div>
            {otp && <p className="text-yellow-400">üîê OTP : {otp}</p>}
            {token && <p className="text-green-400">‚úÖ Token : {token}</p>}
            {error && <p className="text-red-400">‚ùå {error}</p>}
          </div>

          <div className="space-y-2">
            <h2 className="text-xl font-semibold">üì¶ Publication de paquet</h2>
            <input className="w-full p-2 rounded bg-gray-700" placeholder="Nom" value={pkg.name} onChange={e => setPkg({ ...pkg, name: e.target.value })} />
            <input className="w-full p-2 rounded bg-gray-700" placeholder="Version" value={pkg.version} onChange={e => setPkg({ ...pkg, version: e.target.value })} />
            <input className="w-full p-2 rounded bg-gray-700" placeholder="Source" value={pkg.source} onChange={e => setPkg({ ...pkg, source: e.target.value })} />
            <textarea className="w-full p-2 rounded bg-gray-700" placeholder='Metadata (JSON)' value={pkg.metadata} onChange={e => setPkg({ ...pkg, metadata: e.target.value })}></textarea>
            <button className="w-full bg-purple-600 hover:bg-purple-700 p-2 rounded" onClick={publish}>Publier</button>
            {publishResult && <p className="text-indigo-400 break-words">üì§ R√©sultat : {publishResult}</p>}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<GopuApp />);
  </script>
</body>
</html>
